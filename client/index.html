<div id="container">Hi!</div>
<div id="donut">Mmm Donuts</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/mathjs/0.25.0/math.min.js"></script>
<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="//code.highcharts.com/highcharts.js"></script>
<script src="//code.highcharts.com/highcharts-more.js"></script>
<script src="js/output.js"></script>
<script>
  var abilities = _.uniq(_.pluck(output, 'ability'));
  var results = {};
  for(var n in abilities){
    results[abilities[n]] = _.where(output, {'ability': abilities[n]})
    results[abilities[n]] = results[abilities[n]].reduce(function(a, b){
      return {
        damage: a.damage + b.damage };
    });
  }

  var timeChart = [];
  var currentSecond = 0;
  var currentTotal = 0;
  output.map(function(item){
    //Get the current second of our timeline
    var second = item.time.toString().split('.')[0];
    if(second == currentSecond){
      currentTotal += item.damage;
    } else {
      timeChart[currentSecond] = '';
      var dps = currentTotal/currentSecond + 1;
      timeChart[currentSecond] = isNaN(dps) ? 0 : mathjs.round(dps,1);
      currentSecond = second;
      currentTotal += item.damage;
    }
    //timeChart[currentSecond] = timeChart[currentSecond] ? timeChart[currentSecond] + item.damage : item.damage;
  })

  var abilities = {};
  output.map(function(ability){
    if(!abilities[ability.ability]){
      abilities[ability.ability]= {total: 0, normal: 0, crit: 0, multi: 0};
    }

    abilities[ability.ability].total += ability.damage;
    if(ability.multistrike){
      abilities[ability.ability].multi += ability.damage;
    } else if(ability.crit) {
      abilities[ability.ability].crit += ability.damage;
    } else {
      abilities[ability.ability].normal += ability.damage;
    }
  });

  console.log(abilities);

  for(var n in abilities){
    for(var k in abilities[n]){
      if(abilities[n][k] == 0){
        delete abilities[n][k];
      }
    }
    if(!Object.keys(abilities[n]).length){
      delete abilities[n];
    }
  }
  console.log(abilities);



  //console.log(timeChart)
  console.log(abilities);

  //console.log(results);
  var time = 360;

  $(function () {
    $('#container').highcharts({
      chart: {
        zoomType: 'x'
      },
      title: {
        text: 'DPS for 6 minute fight'
      },
      subtitle: {
        text: document.ontouchstart === undefined ?
            'Click and drag in the plot area to zoom in' :
            'Pinch the chart to zoom in'
      },
      xAxis: {
        type: 'combat time',
        minRange: 0,
        maxRange: 360
      },
      yAxis: {
        min: 0,
        title: {
          text: 'damage'
        }
      },
      legend: {
        enabled: false
      },
      plotOptions: {
        area: {
          fillColor: {
            linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1},
            stops: [
              [0, Highcharts.getOptions().colors[0]],
              [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
            ]
          },
          marker: {
            radius: 2
          },
          lineWidth: 1,
          states: {
            hover: {
              lineWidth: 1
            }
          },
          threshold: null
        }
      },

      series: [{
        type: 'area',
        name: 'Damage Per Second',
        pointInterval: 1,
        pointStart: 0,
        data: timeChart
      }]
    });
  });




</script>
<script src="js/donut.js"></script>